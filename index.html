<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Surguja Property Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{font-family:'Inter',sans-serif;background:#f7f9fc;color:#111;-webkit-text-size-adjust:100%;overflow-x:hidden}
header{position:sticky;top:0;z-index:10;background:#fff;display:flex;align-items:center;gap:10px;padding:10px 14px;border-bottom:1px solid rgba(0,0,0,.05);box-shadow:0 2px 6px rgba(0,0,0,.05)}
.logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,#1e88e5,#42a5f5);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
h1{font-size:1.1rem;font-weight:700}
.container{max-width:900px;margin:auto;padding:16px}
.card{background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.06);padding:16px;margin-bottom:16px}
h2{margin-bottom:8px;font-size:1.1rem}
.small-muted{color:#6b7280;font-size:.95rem;margin-bottom:10px}
label{display:block;margin:6px 0 4px;font-weight:600;font-size:.95rem}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #dbe6f0;font-size:1rem}
input:focus,select:focus,textarea:focus{border-color:#1e88e5;outline:none;box-shadow:0 0 0 2px rgba(30,136,229,.15)}
.grid{display:grid;gap:10px}
@media(min-width:720px){.grid-2{grid-template-columns:1fr 1fr}}
button{border:0;border-radius:10px;padding:10px 14px;font-weight:700;font-size:.95rem;cursor:pointer}
.btn-primary{background:#1e88e5;color:#fff}
.btn-primary:hover{background:#1565c0}
.btn-ghost{background:#eef4fb;color:#222}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
.class-list{display:flex;flex-direction:column;gap:12px}
.class-item{background:#fff;padding:12px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.05);display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
.class-info{min-width:0}
.class-info strong{display:block;font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.class-info span{color:#6b7280;font-size:.9rem}
.badge{background:#e3f2fd;color:#0d47a1;padding:4px 8px;border-radius:20px;font-size:.8rem;font-weight:700;margin-right:5px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:100}
.modal.active{display:flex}
.modal-box{background:#fff;border-radius:12px;padding:16px;max-width:520px;width:92%}
.toast{position:fixed;bottom:16px;right:16px;background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transition:.3s;z-index:200}
.toast.show{opacity:1}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px 10px;border-bottom:1px solid rgba(0,0,0,.05);font-size:.9rem;text-align:left}
th{background:#f2f5f9;font-weight:700}
footer{text-align:center;padding:14px;color:#6b7280;font-size:.9rem}
.user-actions{display:flex;gap:6px;margin-top:6px}
.user-actions button{font-size:.8rem;padding:6px 10px}
.message{margin-top:10px;padding:10px;border-radius:10px;background:#eef7ee;color:#064e3b;display:none}
.error{background:#fff2f0;color:#7a271a;border-radius:10px;padding:10px;display:none;margin-top:10px}
</style>
</head>
<body>
<header><div class="logo">SP</div><h1>Surguja Property Hub</h1></header>

<main class="container">
  <section class="card" aria-labelledby="reqTitle">
    <h2 id="reqTitle">अपनी आवश्यकता दर्ज करें</h2>
    <p class="small-muted">सुरगुजा संभाग केंद्रित खरीदार सेवा। अपनी आवश्यकता साझा करें; जैसे ही उपयुक्त संपत्ति उपलब्ध होगी, हम आपको सूचित करेंगे।</p>

    <form id="reqForm" novalidate>
      <label for="name">नाम</label>
      <input id="name" name="name" type="text" placeholder="पूरा नाम">

      <label for="phone">मोबाइल नंबर (अनिवार्य)</label>
      <input id="phone" name="phone" type="tel" inputmode="numeric" placeholder="10-digit mobile" required>

      <div class="grid grid-2">
        <div>
          <label for="ptype">प्रॉपर्टी प्रकार</label>
          <select id="ptype" name="ptype">
            <option>Plot</option><option>House</option><option>Land</option><option>Commercial</option><option>Rental</option>
          </select>
        </div>
        <div>
          <label for="location">स्थान</label>
          <input id="location" name="location" type="text" placeholder="e.g., Ambikapur">
        </div>
      </div>

      <div class="grid grid-2">
        <div><label for="budgetMin">Budget Min (₹)</label><input id="budgetMin" name="budgetMin" type="number" placeholder="e.g., 500000"></div>
        <div><label for="budgetMax">Budget Max (₹)</label><input id="budgetMax" name="budgetMax" type="number" placeholder="e.g., 2500000"></div>
      </div>

      <label for="postDate">तारीख चुनें</label>
      <input id="postDate" name="postDate" type="date">

      <label for="notes">नोट्स</label>
      <textarea id="notes" name="notes" rows="3" placeholder="Facing, loan need, etc."></textarea>

      <div class="actions">
        <button type="submit" class="btn-primary">Submit Requirement</button>
        <button type="reset" class="btn-ghost">Clear</button>
      </div>

      <div id="submitMsg" class="message" role="status" aria-live="polite"></div>
      <div id="submitError" class="error" role="alert"></div>
    </form>
  </section>

  <section class="card">
    <h2>Classified Listings</h2>
    <div id="classGrid" class="class-list" style="margin-top:8px" aria-live="polite"></div>
  </section>

  <section id="adminPanel" class="card" style="display:none">
    <h2>Admin Panel</h2>
    <div style="overflow:auto">
      <table>
        <thead><tr><th>Date</th><th>Name</th><th>Phone</th><th>Type</th><th>Location</th><th>Budget Range</th><th>Actions</th></tr></thead>
        <tbody id="reqBody"></tbody>
      </table>
    </div>
  </section>

  <div style="text-align:center;margin-top:10px">
    <button id="adminBtn" class="btn-ghost">Admin</button>
  </div>
</main>

<footer>© 2025 Surguja Property Hub · Contact: +91-8319454138</footer>

<!-- Modal + Toast -->
<div id="classModal" class="modal" aria-hidden="true">
  <div class="modal-box" role="dialog" aria-modal="true">
    <h3 id="mTitle"></h3>
    <div id="mBody" style="margin-top:8px"></div>
    <div style="margin-top:12px"><button id="closeModal" class="btn-primary" style="width:100%">Close</button></div>
  </div>
</div>

<div id="toast" class="toast" aria-live="polite"></div>

<script>
document.addEventListener('DOMContentLoaded', ()=>{

  const $ = sel => document.querySelector(sel);
  const dbKey = 'reqDB_v3';
  const ADMIN_PASSWORD = 'surguja@2025';
  const REVEAL = '8319454138';

  const toastEl = $('#toast');
  function toast(msg){
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    setTimeout(()=>toastEl.classList.remove('show'), 2200);
  }

  function load(){ try { return JSON.parse(localStorage.getItem(dbKey) || '[]'); } catch (e) { return []; } }
  function save(list){ localStorage.setItem(dbKey, JSON.stringify(list)); }

  function fmtINR(n){
    if(n==null || n==='') return '';
    if(typeof n === 'number') return new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0}).format(n);
    return n;
  }
  function maskLast5(v){ const s = (v||'').replace(/\D/g,''); return '*****'+s.slice(-5); }

  // demo static classifieds
  const classifiedsStatic = [
    { title:'House for Sale – Ambikapur', type:'House', area:'Ambikapur', price:3200000, desc:'2BHK near main market', phone:'9876543210' },
    { title:'Plot – Udaipur', type:'Plot', area:'Udaipur', price:900000, desc:'East-facing, 20ft road', phone:'9988776655' }
  ];

  // Set min date for date input to today (no past dates)
  (function setMinDate(){
    const dt = new Date();
    const yyyy = dt.getFullYear();
    const mm = String(dt.getMonth()+1).padStart(2,'0');
    const dd = String(dt.getDate()).padStart(2,'0');
    const min = `${yyyy}-${mm}-${dd}`;
    $('#postDate').setAttribute('min', min);
  })();

  // Render classifieds (user requirements + static). Latest first.
  function renderClassifieds(){
    const grid = $('#classGrid');
    grid.innerHTML = '';
    const reqs = load(); // user posts (local)
    const combined = [
      ...reqs.map(r => ({ title: `${r.ptype} Requirement – ${r.location||''}`, type: r.ptype, area: r.location, price: `${r.budgetMin||''}-${r.budgetMax||''}`, desc: r.notes, phone: r.phone, id: r.id, user: true, date: r.date || r.ts })),
      ...classifiedsStatic.map(c => ({ ...c, user: false, date: c.date || '' }))
    ];
    combined.sort((a,b)=>{
      const da = new Date(a.date || a.ts || 0).getTime();
      const db = new Date(b.date || b.ts || 0).getTime();
      return db - da;
    });

    if(combined.length === 0){
      const note = document.createElement('div');
      note.className = 'small-muted';
      note.textContent = 'No listings yet.';
      grid.appendChild(note);
      return;
    }

    combined.forEach(item=>{
      const row = document.createElement('div');
      row.className = 'class-item';
      const priceText = item.price ? (isNaN(Number(item.price)) ? item.price : fmtINR(Number(item.price))) : '-';
      row.innerHTML = `
        <div class="class-info">
          <strong title="${(item.title||'')}">${item.title}</strong>
          <span>${item.area||'-'} • ${priceText}</span>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button class="btn-ghost view-btn" type="button" aria-label="View">View</button>
          ${item.user ? `<button class="btn-ghost edit-btn" type="button" data-id="${item.id}">Edit</button><button class="btn-ghost del-btn" type="button" data-id="${item.id}">Delete</button>` : ''}
        </div>
      `;
      // view handler
      row.querySelector('.view-btn').addEventListener('click', (e)=>{
        e.stopPropagation();
        openModal(item);
      });
      // edit & delete for user items
      if(item.user){
        row.querySelector('.edit-btn').addEventListener('click', (e)=>{
          e.stopPropagation();
          const rec = load().find(x=>x.id === item.id);
          if(rec) fillForm(rec, true);
          window.scrollTo({top:0, behavior:'smooth'});
        });
        row.querySelector('.del-btn').addEventListener('click', (e)=>{
          e.stopPropagation();
          if(confirm('Delete this post?')){
            const newAll = load().filter(x=>x.id !== item.id);
            save(newAll);
            renderClassifieds();
            renderTable();
            showSubmissionMessage('Deleted your post');
            toast('Deleted');
          }
        });
      }
      grid.appendChild(row);
    });
  }

  function openModal(item){
    $('#mTitle').textContent = item.title || '';
    $('#mBody').innerHTML = `
      <p><strong>Type:</strong> ${item.type || '-'}</p>
      <p><strong>Area:</strong> ${item.area || '-'}</p>
      <p><strong>Price Range:</strong> ${item.price || '-'}</p>
      ${item.desc ? `<p><strong>Details:</strong> ${item.desc}</p>` : ''}
      <p><strong>Phone:</strong> ${maskLast5(item.phone || '')}<br>
         <button id="revealBtn" class="btn-ghost" style="margin-top:8px">Reveal</button></p>
    `;
    $('#classModal').classList.add('active');
    const rb = $('#revealBtn');
    if(rb) rb.addEventListener('click', ()=> alert(`contact ${REVEAL} to know customer's contact details.`));
  }
  $('#closeModal').addEventListener('click', ()=> $('#classModal').classList.remove('active'));

  // Fill form for edit
  function fillForm(rec, isEdit=false){
    $('#name').value = rec.name || '';
    $('#phone').value = rec.phone || '';
    $('#ptype').value = rec.ptype || 'Plot';
    $('#location').value = rec.location || '';
    $('#budgetMin').value = rec.budgetMin || '';
    $('#budgetMax').value = rec.budgetMax || '';
    $('#notes').value = rec.notes || '';
    // set date (YYYY-MM-DD)
    try{
      const d = rec.date ? new Date(rec.date) : new Date();
      $('#postDate').value = d.toISOString().slice(0,10);
    }catch(e){}
    if(isEdit) $('#reqForm').dataset.editId = rec.id;
    else delete $('#reqForm').dataset.editId;
    // clear previous messages
    hideSubmissionMessage();
  }

  // Show inline confirmation message (below form)
  function showSubmissionMessage(msg){
    const el = $('#submitMsg');
    el.textContent = msg;
    el.style.display = 'block';
    setTimeout(()=>{ el.style.display = 'none'; }, 4200);
  }
  function showSubmissionError(msg){
    const el = $('#submitError');
    el.textContent = msg;
    el.style.display = 'block';
    setTimeout(()=>{ el.style.display = 'none'; }, 4200);
  }
  function hideSubmissionMessage(){ $('#submitMsg').style.display = 'none'; $('#submitError').style.display='none';}

  // Form submit: mobile-number required & 10 digits
  $('#reqForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    hideSubmissionMessage();
    const name = $('#name').value.trim();
    const phoneRaw = $('#phone').value.replace(/\s+/g,'').trim();
    const phoneDigits = phoneRaw.replace(/\D/g,'');
    if(!phoneDigits || phoneDigits.length !== 10){
      showSubmissionError('कृपया मान्य 10-डिजिट मोबाइल नंबर दर्ज करें');
      toast('Enter a valid 10-digit mobile number');
      return;
    }
    const ptype = $('#ptype').value;
    const location = $('#location').value.trim();
    const budgetMin = $('#budgetMin').value.trim();
    const budgetMax = $('#budgetMax').value.trim();
    const notes = $('#notes').value.trim();
    const dateVal = $('#postDate').value || new Date().toISOString();
    const now = new Date();
    const id = $('#reqForm').dataset.editId || Date.now().toString();
    const rec = {
      id,
      ts: now.toISOString(),
      date: dateVal,
      name: name || '-',
      phone: phoneDigits,
      ptype,
      location,
      budgetMin,
      budgetMax,
      notes
    };
    const all = load();
    const idx = all.findIndex(x=>x.id === id);
    if(idx >= 0){
      all[idx] = rec;
      save(all);
      showSubmissionMessage('Requirement updated successfully');
      toast('Updated');
    } else {
      all.unshift(rec);
      save(all);
      showSubmissionMessage('Requirement submitted successfully');
      toast('Submitted');
    }
    $('#reqForm').reset();
    delete $('#reqForm').dataset.editId;
    renderClassifieds();
    renderTable();
  });

  // Render admin table with edit/delete buttons
  function renderTable(){
    const tb = $('#reqBody');
    tb.innerHTML = '';
    const rows = load();
    if(!rows.length){
      tb.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#777;padding:10px">No data</td></tr>';
      return;
    }
    rows.forEach(r=>{
      const tr = document.createElement('tr');
      const bd = `${r.budgetMin || '-'} – ${r.budgetMax || '-'}`;
      tr.innerHTML = `<td>${new Date(r.date || r.ts).toLocaleDateString()}</td><td>${r.name}</td><td>${r.phone}</td><td>${r.ptype}</td><td>${r.location}</td><td>${bd}</td><td><button class="btn-ghost edit-admin" data-id="${r.id}" style="margin-right:6px;padding:6px 8px">Edit</button><button class="btn-ghost del-admin" data-id="${r.id}" style="padding:6px 8px">Delete</button></td>`;
      tb.appendChild(tr);
    });
    tb.querySelectorAll('.del-admin').forEach(b=>{
      b.addEventListener('click', ()=>{
        if(confirm('Delete this requirement?')){
          const id = b.getAttribute('data-id');
          const newAll = load().filter(x=>x.id !== id);
          save(newAll);
          renderTable();
          renderClassifieds();
          showSubmissionMessage('Deleted');
          toast('Deleted');
        }
      });
    });
    tb.querySelectorAll('.edit-admin').forEach(b=>{
      b.addEventListener('click', ()=>{
        const id = b.getAttribute('data-id');
        const rec = load().find(x=>x.id === id);
        if(rec) {
          fillForm(rec, true);
          window.scrollTo({top:0, behavior:'smooth'});
        }
      });
    });
  }

  // Admin button: opens admin panel after password check
  $('#adminBtn').addEventListener('click', ()=>{
    const p = prompt('Enter Admin Password');
    if(p === ADMIN_PASSWORD){
      $('#adminPanel').style.display = 'block';
      renderTable();
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      toast('Admin unlocked');
    } else {
      toast('Wrong Password');
    }
  });

  // Initialize UI
  renderClassifieds();
  hideSubmissionMessage();

  // Prevent horizontal overflow
  document.documentElement.style.overflowX = 'hidden';
  document.body.style.overflowX = 'hidden';

}); // DOMContentLoaded end
</script>
</body>
</html>